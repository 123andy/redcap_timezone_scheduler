{
    "name": "Timezone Scheduler",

    "namespace": "Stanford\\TimezoneScheduler",

    "description": "This module is intended to facilitate scheduling with support for multiple client timezones",

    "documentation": "README.md",

    "framework-version": 16,

    "authors": [
        {
            "name": "Andy Martin",
            "email": "andy123@stanford.edu",
            "institution": "Stanford Medicine"
        }
    ],

    "enable-every-page-hooks-on-system-pages": false,

    "enable-ajax-logging": false,

    "auth-ajax-actions": [
        "TestAction",
        "getTimezones",
        "getAppointmentData",
        "getAppointmentOptions",
        "cancelAppointment",
        "getSlot",
        "reserveSlot",
        "addToCalendar",
        "cancelAppointmentFromUrl"
    ],

    "no-auth-ajax-actions": [
        "TestAction",
        "getTimezones",
        "getAppointmentData",
        "getAppointmentOptions",
        "cancelAppointment",
        "getSlot",
        "reserveSlot",
        "addToCalendar",
        "cancelAppointmentFromUrl"
    ],

    "links": {
        "project": [
            {
                "name": "Timezone Scheduler Admin",
                "icon": "fas fa-cog",
                "url": "pages/admin.php",
                "show-header-and-footer": true
            }
        ],
        "control-center": [

        ]
    },

    "no-auth-pages": [
        "pages/cancel"
    ],

    "project-settings": [
        {
            "key": "instructions",
            "name": "<b>Instructions</b><br>This module allows participants to select appointments from a separate REDCap project that acts as an 'Appointment Slot Database'.  In this project, the appointment is stored as a 'slot_id' from the Slot database.  You can optionally store additional information in other fields.<br/><br/>Please see the sidebar link added to the project (only visible to users with design rights)",
            "type": "descriptive"
        },
        {
            "key": "timezone-database",
            "name": "<b>Timezone Database</b><br/>Select what Timezone groups you wish to include in the lookup tooltip.  The default is to include <a href='https://www.iana.org/time-zones' target='_blank'>all global timezones</a>, but you can limit the options to only those that are relevant to your study population.<ul><li>Note that someone outside of the provided timezones can still use their browser-based default timezone to book an appointment.  This selection only limits the custom timezone dropdown options</li></ul>If you wish to have more custom timezone groups, please contact the developer.",
            "type": "dropdown",
            "required": true,
            "choices": [
                { "value": "all", "name": "All Global Timezones (default)" },
                { "value": "usa", "name": "United States (custom w/ 4 options)" },
                { "value": "north_america", "name": "North America (custom w/ 8 options)" },
                { "value": "europe", "name": "Europe (custom w/ 7 options)" }
            ]
        },
        {
            "name": "Configuration instance for each reservable appointment slot",
            "key": "instances",
            "type": "sub_settings",
            "repeatable": true,
            "sub_settings": [
                {
                    "key": "slot-project-id",
                    "name": "<b>Slot DB Project ID</b><br>Enter the project_id on this server that contains the database of available reservation slots.  The project MUST match the required project format (<i>i.e.</i> use the provided XML template to create any new slot projects)",
                    "required": true,
                    "type": "project-id"
                },
                {
                    "key": "appt-field",
                    "name": "<b>Appointment Field</b><br/>This field will display a button to select an available slot or a summary of the scheduled appointment.  The field will store the <code>slot_id</code> of the appointment and should be of type text",
                    "required": true,
                    "type": "field-list",
                    "field-type": "text"
                },
                {
                    "key": "appt-button-label",
                    "name": "<b>Appointment Button Label</b><br/><i>(Optional)</i> Customize the appointment button label<ul><li>if blank it will read: <button class='button btn-xs btn-primaryrc'>Select An Appointment</button></li></ul>",
                    "required": false,
                    "type": "text"
                },
                {
                    "key": "appt-event-id",
                    "name": "<b>Appointment Field Event</b><br/>Select the event where the Appointment Field above resides.<ul><li><i>If you wish to use the same Appointment Field in a form that is enabled on multiple events, you must create a configuration instance for each event</i></li></ul>",
                    "required": true,
                    "type": "event-list"
                },
                {
                    "key": "appt-datetime-field",
                    "name": "<b>Appointment Server DateTime Field</b><br><i>(Optional)</i> If specified, the <b>server timestamp</b> for this appointment will be stored.  This can be used to automate reminders to the participant using datediff logic and notifications.  <ul><li>validate as <b>Y-M-D H:M</b>, any other format may cause errors.</li><li>field must present in the Appointment Field Event</li><li>recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey</li></ul>",
                    "required": false,
                    "type": "field-list",
                    "validation": "datetime"
                },
                {
                    "key": "appt-description-format",
                    "name": "<b>Override Appointment Description Format</b><br><i>(Optional)</i> This is how the appointment will be seen by the participant.  If blank, a default format is used:<ul><li><code>{title} (#{slot_id})<br/>{client-nicedate} at {client-time} {client-tza}<br/><==({server-time} {server-tza})==></code></li></ul>You can customize the format, similar to piping, using the syntax below:<pre style='font-size:smaller;'>{slot_id} => slot db record id<br/>{title} => slot title<br/>{date} => slot date (yyyy-mm-dd)<br/>{time} => slot time (hh:mm) in 24 hour format<br/>{server-time} => 'HH:MM am/pm' in server timezone<br/>{server-nicedate} => 'Sat, Jan 1st, 2025'<br/>{server-date} => date (mm/dd/yyyy)<br/>{server-ts} => server timestamp 'yyyy-mm-dd hh:mm'<br/>{server-tza} => short server timezone abbreviation (e.g. PST, EDT)<br/>{client-time} => 'HH:MM am/pm' in client timezone<br/>{client-nicedate} => 'Sat, Jan 1st, 2025'<br/>{client-tza} => short client timezone abbreviation (e.g. PST, CST, EDT)<br/>{client-date} => 'mm/dd/yyyy'<br/>{client-ts} => client timestamp 'yyyy-mm-dd hh:mm'<br/>{client-tz} => 'America/Los_Angeles'<br/>{diff} => duration until appointment 'x days y hours'</pre><ul><li>Any parts surrounded by <code><==</code> and <code>==></code> will be omitted if the client timezone and the server timezone are the same to reduce redundency</li></ul>",
                    "required": false,
                    "type": "textarea"
                },
                {
                    "key": "appt-description-field",
                    "name": "<b>Appointment Description Field</b><br><i>(Optional)</i> The above appointment description can be saved into a field,  useful for piping into reminders with participants timezone.<ul><li>field must be of type <u>note</u></li><li>recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey</li></ul>",
                    "required": false,
                    "type": "field-list",
                    "field-type": "textarea"
                },
                {
                    "key": "slot-filter-field",
                    "name": "<b>Slot Filter Field</b><br><i>(Optional)</i> If set, only those slots that have a matching <code>slot filter value</code> will be displayed.<ul><li>- You can use a <code>@CALCTEXT</code> field to create complex slot filter values, but the value must already be saved for the record.  So, a @CALCTEXT field on the same page as the appointment selector field may not operate as intended, <i>i.e.</i> use the multipages pagination in survey settings to save the value before scheduling the appointment</li></ul>",
                    "required": false,
                    "type": "field-list"
                },
                {
                    "key": "appt-participant-text-date-field",
                    "name": "<b>Appointment Participant Text Date Field</b><br><i>(Optional)</i> If specified, a simplified version of the selected date will be stored, <i>e.g. Wed, Nov 5th, 2025 at 9:00 AM CST</i>.<ul><li>Must be a <u>text field</u> (do not validate it as a date/time as this will fail)</li><li>recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey</li></ul>",
                    "required": false,
                    "type": "field-list",
                    "field-type": "text"
                },
                {
                    "key": "appt-cancel-url-field",
                    "name": "<b>Cancel Appointment URL</b><br><i>(Optional)</i> This field will contain a URL that will goto a page to cancel the appointment.  This is useful if you wish to give participants the ability to cancel an appointment in an email notification.<br/>It is recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey",
                    "required": false,
                    "type": "field-list",
                    "field-type": "text"
                },
                {
                    "key": "slot-record-url-field",
                    "name": "<b>Slot Record URL</b><br><i>(Optional)</i> This field will contain a URL to the Slot DB Project for the reserved appointment.  Useful for an admin to be able to jump to the Slot database.<br/>It is recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey",
                    "required": false,
                    "type": "field-list",
                    "field-type": "text"
                },
                {
                    "key": "slot-filter-expression",
                    "name": "<b>Filter Expression</b><br>(to be developed) -- idea is that you could enter expression here that would be evaluated with the record's data and could be used to select a subset of available slots in the other database...",
                    "required": false,
                    "type": "text"
                },
                {
                    "key": "disabled",
                    "name": "<b>Disable</b><br>Check to disable this config without deleting it",
                    "type": "checkbox"
                }
            ]
        },
        {
            "key": "enable-project-debug-logging",
            "name": "<b>Enable Debug Logging</b><br><i>(optional)</i> Requires installation and configuration of emLogger",
            "required": false,
            "type": "checkbox"
        }
    ],

    "system-settings": [
        {
            "key": "enable-system-debug-logging",
            "name": "<b>Enable Debug Logging (system-wide)</b><i>(optional)</i> Requires installation and configuration of emLogger",
            "required": false,
            "type": "checkbox"
        }
    ],

    "crons": [

    ],

    "compatibility": {
        "php-version-min": "",
        "php-version-max": "",
        "redcap-version-min": "",
        "redcap-version-max": ""
    }
}
