{
    "name": "Timezone Scheduler",

    "namespace": "Stanford\\TimezoneScheduler",

    "description": "This module is intended to facilitate scheduling with support for multiple client timezones",

    "documentation": "README.md",

    "framework-version": 16,

    "authors": [
        {
            "name": "Andy Martin",
            "email": "andy123@stanford.edu",
            "institution": "Stanford Medicine"
        }
    ],

    "enable-every-page-hooks-on-system-pages": false,

    "enable-ajax-logging": false,

    "auth-ajax-actions": [
        "TestAction",
        "getTimezones",
        "getAppointmentData",
        "getAppointmentOptions",
        "cancelAppointment",
        "getSlot",
        "reserveSlot"
    ],

    "no-auth-ajax-actions": [
        "TestAction",
        "getTimezones",
        "getAppointmentData",
        "getAppointmentOptions",
        "cancelAppointment",
        "getSlot",
        "reserveSlot"

    ],

    "links": {
        "project": [
            {
                "name": "Timezone Scheduler Admin",
                "icon": "fas fa-cog",
                "url": "pages/admin.php",
                "show-header-and-footer": true
            }
        ],
        "control-center": [

        ]
    },

    "no-auth-pages": [

    ],

    "project-settings": [
        {
            "key": "instructions",
            "name": "<b>Instructions</b><br>This module allows participants to select appointments from a separate REDCap project that acts as an 'Appointment Slot Database'.  In this project, the appointment is stored as a 'slot_id' from the Slot database.  You can optionally store additional information in other fields.<br/><br/>Please see the sidebar link added to the project (only visible to users with design rights)",
            "type": "descriptive"
        },
        {
            "name": "Configuration instance for each reservable appointment slot",
            "key": "instances",
            "type": "sub_settings",
            "repeatable": true,
            "sub_settings": [
                {
                    "key": "slot-project-id",
                    "name": "<b>Slot DB Project ID</b><br>Enter the project_id on this server that contains the database of available reservation slots.  The project MUST match the required project format (<i>i.e.</i> use the provided XML template to create any new slot projects)",
                    "required": true,
                    "type": "project-id"
                },
                {
                    "key": "appt-field",
                    "name": "<b>Appointment Field</b><br>This field will display a button to select an available slot or a summary of the scheduled appointment.  The field will store the <code>slot_id</code> of the appointment and should be of type text",
                    "required": true,
                    "type": "field-list",
                    "field-type": "text"
                },
                {
                    "key": "appt-button-label",
                    "name": "<b>Appointment Button Label</b><br><i>(Optional)</i> Customize the button label - if blank it will read: <button class='button btn-xs btn-primaryrc'>Select An Appointment</button>",
                    "required": false,
                    "type": "text"
                },
                {
                    "key": "appt-event-id",
                    "name": "<b>Appointment Field Event</b><br>Select the event where the Appointment Field above resides.<br/><span><sup>*</sup><i>If you wish to use the same Appointment Field in a form that is enabled on multiple events, you must create a configuration instance for each event</i></span>",
                    "required": true,
                    "type": "event-list"
                },
                {
                    "key": "appt-datetime-field",
                    "name": "<b>Appointment Server DateTime Field</b><br><i>(Optional)</i> Field in this project to hold the appointment date/time in the <b>server's timezone</b>.  This can be used to automate reminders to the participant using datediff logic.  This field <b>MUST BE VALIDATED AS Y-M-D H:M</b> - any other format may cause errors.  It must also be in the same event above<br/>It is recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey",
                    "required": false,
                    "type": "field-list",
                    "validation": "datetime"
                },
                {
                    "key": "appt-description-format",
                    "name": "<b>Appointment Description Format</b><br><i>(Optional)</i> Specify the format (like piping) for the appointment description. This format will control what the participant sees after selecting an appointment.  If blank, a default format is used:<div class='p-1 alert alert-secondary'>{title} (#{slot_id})<br/>{client-nicedate} at {client-time} {client-tza}<br/><==({server-time} {server-tza})==></div>The available replacement tags are listed below:<pre style='font-size:smaller;'>{slot_id} => slot db record id<br/>{title} => slot title<br/>{date} => slot date (yyyy-mm-dd)<br/>{time} => slot time (hh:mm) in 24 hour format<br/>{server-time} => 'HH:MM am/pm' in server timezone<br/>{server-nicedate} => 'Sat, Jan 1st, 2025'<br/>{server-date} => date (mm/dd/yyyy)<br/>{server-ts} => server timestamp 'yyyy-mm-dd hh:mm'<br/>{server-tza} => short server timezone abbreviation (e.g. PST, EDT)<br/>{client-time} => 'HH:MM am/pm' in client timezone<br/>{client-nicedate} => 'Sat, Jan 1st, 2025'<br/>{client-tza} => short client timezone abbreviation (e.g. PST, CST, EDT)<br/>{client-date} => 'mm/dd/yyyy'<br/>{client-ts} => client timestamp 'yyyy-mm-dd hh:mm'<br/>{client-tz} => 'America/Los_Angeles'<br/>{diff} => duration until appointment 'x days y hours'</pre><sup>*</sup>Any parts surrounded by <code><==</code> and <code>==></code> will be omitted if the client timezone and the server timezone are the same to reduce redundency",
                    "required": false,
                    "type": "textarea"
                },
                {
                    "key": "appt-description-field",
                    "name": "<b>Appointment Description Field</b><br><i>(Optional)</i> The appointment description specified above can be saved into a <u>note field</u>.  This is useful for piping into the body of a confirmation or reminder email<br/>It is recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey",
                    "required": false,
                    "type": "field-list",
                    "field-type": "textarea"
                },
                {
                    "key": "appt-participant-formatted-date-field",
                    "name": "<b>Appointment Participant Formatted Date</b><br><i>(Optional)</i> Select a <b>text field</b> (do not validate it as a date/time as this will fail!) and the nicely formatted string that the participant saw when selecting their appointment will be stored.  This could be piped into a reminder email so the participant can see the appointment time in their selected timezone.<br/>It is recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey",
                    "required": false,
                    "type": "field-list",
                    "field-type": "text"
                },
                {
                    "key": "slot-record-url-field",
                    "name": "<b>Slot Record URL</b><br><i>(Optional)</i> This field will contain a URL to the Slot DB Project for the reserved appointment.  Useful for an admin to be able to jump to the Slot database.<br/>It is recommended to use <code>@HIDDEN-SURVEY</code> or place this field on a different instrument so the participant does not see it in the survey",
                    "required": false,
                    "type": "field-list",
                    "field-type": "text"
                },
                {
                    "key": "slot-filter-expression",
                    "name": "<b>Filter Expression</b><br>(to be developed) -- idea is that you could enter expression here that would be evaluated with the record's data and could be used to select a subset of available slots in the other database...",
                    "required": false,
                    "type": "text"
                },
                {
                    "key": "disabled",
                    "name": "<b>Disable</b><br>Check to disable this config without deleting it",
                    "type": "checkbox"
                }
            ]
        },
        {
            "key": "enable-project-debug-logging",
            "name": "<b>Enable Debug Logging</b><br><i>(optional)</i> Requires installation and configuration of emLogger",
            "required": false,
            "type": "checkbox"
        }
    ],

    "system-settings": [
        {
            "key": "enable-system-debug-logging",
            "name": "<b>Enable Debug Logging (system-wide)</b><i>(optional)</i> Requires installation and configuration of emLogger",
            "required": false,
            "type": "checkbox"
        }
    ],

    "crons": [

    ],

    "compatibility": {
        "php-version-min": "",
        "php-version-max": "",
        "redcap-version-min": "",
        "redcap-version-max": ""
    }
}
